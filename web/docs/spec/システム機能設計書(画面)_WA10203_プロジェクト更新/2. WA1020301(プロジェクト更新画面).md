# PJ名
サンプルプロジェクト

# 成果物名
システム機能設計書（画面）

**作成**: TIS (2020/03/05)  
**変更**: TIS (2022/12/13)

# システム名
サンプルシステム

# サブシステム名
プロジェクト管理システム

## 2. WA1020301(プロジェクト更新画面)

### 2.1. 画面レイアウト

### 2.2. 一覧表示

| No. | 領域名 | ページング有無 | ソート条件 | 備考 |
|-----|--------|----------------|------------|------|
| 1 | - | - | - | - |

### 2.3. 画面項目定義

| No. | 表示情報 | ドメイン名 | 画面項目名（物理） |
|-----|-----------|------------|-------------------|

| 画面項目名 | 画面項目種別 | 情報取得元 | 編集仕様 | 初期値 | 必須 |
|------------|--------------|------------|-----------|---------|------|

### 領域名：プロジェクト情報入力

| No. | 画面項目名 | 画面項目種別 | 情報取得元 | 編集仕様 | 初期値 | 必須 | ドメイン名 | 画面項目名（物理） |
|-----|------------|--------------|------------|-----------|---------|------|------------|-------------------|
| 1 | プロジェクトID | hidden | プロジェクト、プロジェクトID | - | - | ○ | プロジェクトID | projectId |
| 1 | 事業部 | select(pulldown) | 組織、組織名 | - | - | ○ | 組織ID | divisionId |
| 2 | 部門 | select(pulldown) | 組織、組織名 | - | - | ○ | 組織ID | organizationId |
| 3 | PJ名 | text | プロジェクト、プロジェクト名 | - | - | ○ | プロジェクト名 | projectName |
| 4 | PJ種別 | select(pulldown) | プロジェクト、プロジェクト種別 | ＜コード値取得情報＞ | - | ○ | プロジェクト種別 | projectType |
| 5 | PJ分類 | radio | プロジェクト、プロジェクト分類 | ＜コード値取得情報＞ | - | ○ | プロジェクト分類 | projectClass |
| 6 | 売上高(千円) | text | プロジェクト、売上高 | - | - | - | 金額 | sales |
| 7 | 顧客 | label | 顧客管理システム、顧客詳細取得API | 顧客検索画面で選択した顧客の顧客名を表示 | - | ○ | 顧客ID | clientId |
| 8 | PM | text | プロジェクト、プロジェクトマネージャー | - | - | ○ | ユーザ氏名（漢字） | projectManager |
| 9 | PL | text | プロジェクト、プロジェクトリーダー | - | - | ○ | ユーザ氏名（漢字） | projectLeader |
| 10 | 開始日 | calendar | プロジェクト、プロジェクト開始日付 | ＜表示変換:日付変換＞ | - | ○ | 日付 | projectStartDate |
| 11 | 終了日 | calendar | プロジェクト、プロジェクト終了日付 | ＜表示変換:日付変換＞ | - | ○ | 日付 | projectEndDate |
| 12 | 備考 | textarea | プロジェクト、備考 | - | - | - | 備考 | note |
| 12 | バージョン番号 | hidden | プロジェクト、バージョン番号 | - | - | ○ | バージョン番号 | versionNo |

### 2.4. 入出力一覧

| No. | 入出力名 | 種別 | I/O | DBアクセス種別 | 備考 |
|-----|-----------|------|-----|----------------|------|
| | | | | C R U D ﾛｯｸ対象 | |
| 1 | 組織 | テーブル | I | - ○ - - - | - |

| No. | 入出力名 | 種別 | I/O | DBアクセス種別 | 備考 |
|-----|-----------|------|-----|----------------|------|
| 2 | プロジェクト | テーブル | I | - ○ - - - | - |

### 2.5. 画面イベント一覧

| No. | 画面イベント名 | 発生タイミング | 画面イベント概要 | 正常時遷移先画面 | サーバ通信有無 |
|-----|----------------|-----------------|------------------|------------------|----------------|
| 1 | 初期表示 | ‐ | プロジェクト更新画面を表示する。 | - | あり(同期) |
| 2 | 部門リスト取得 | 「事業部」プルダウン選択 | 選択された事業部をもとに、配下部門リストを「部門」プルダウンに設定する。 | - | あり(非同期) |
| 3 | 顧客検索 | 「顧客選択」ボタン押下 | 顧客検索画面を開く。 | 顧客検索画面 | あり(同期) |
| 4 | 戻る | 「戻る」ボタン押下 | プロジェクト詳細画面を表示する。 | プロジェクト詳細画面 | あり(同期) |
| 5 | 確認 | 「確認」ボタン押下 | 入力内容のバリデーション処理を行い、プロジェクト更新確認を表示する。 | プロジェクト更新確認 | あり(同期) |

### 2.6. 画面イベント詳細
#### 2.6.1.初期表示イベント

##### (1) バリデーション処理

なし。

##### (2) DBアクセス（検索処理）

###### (a) プロジェクト検索条件

| 取得テーブル名 | 取得カラム名 | 画面項目名 |
|----------------|--------------|------------|
| プロジェクト | プロジェクトID | - |
| | プロジェクト名 | PJ名 |
| | プロジェクト種別 | PJ種別 |
| | プロジェクト分類 | PJ分類 |
| | 売上高 | 売上高 |
| | 顧客ID | - |
| | プロジェクトマネージャー | PM |
| | プロジェクトリーダー | PL |
| | プロジェクト開始日付 | 開始日 |
| | プロジェクト終了日付 | 終了日 |
| | 備考 | 備考 |
| | バージョン番号 | - |
| 事業部 | 組織名 | 事業部 |
| 部門 | 組織名 | 部門 |
| 結合条件

プロジェクト

LEFT OUTER JOIN 組織 AS 部門
ON プロジェクト．組織ID = 部門．組織ID

LEFT OUTER JOIN 組織 AS 事業部
ON 部門．上位組織ID = 事業部．組織ID

**検索条件**

プロジェクト．プロジェクトID = プロジェクトID(入力値)

(b) 上記で取得した顧客IDをパラメータとして、顧客管理システム．顧客詳細取得APIを実行し顧客名を取得する。

(c) 組織検索条件

| 取得テーブル名 | 取得カラム名 |
|----------------|--------------|
| 組織 | 組織ID |
| | 組織名 |

**検索条件**

組織.上位組織ID = NULL

##### (3)　表示処理

(a)「(2)-(a) プロジェクト検索条件)」の検索結果がない場合

汎用エラー画面を表示する。

(b)「(2)-(a) プロジェクト検索条件)」の検索結果がある場合

1.「事業部」プルダウンを初期化する。
- 「(2)-(b)組織検索条件)」の検索結果の先頭にブランクオプションを追加して、「事業部」に設定する。
- プルダウンの表示項目には組織名を、値には組織IDを使用する。

2.検索結果を「プロジェクト更新画面」に表示する。

#### 2.6.2.部門リスト取得イベント

##### (1) バリデーション処理

なし。

##### (2) DBアクセス（検索処理）
###### (a) 組織検索条件

| 取得テーブル名 | 取得カラム名 |
|----------------|--------------|
| 組織 | 組織ID |
| | 組織名 |

**検索条件**

組織.上位組織ID = 事業部（入力値）

##### (3)　表示処理

(a)「部門」プルダウンを初期化する。
- 「(2) 検索処理」の検索結果の先頭にブランクオプションを追加して、「部門」に設定する。
- プルダウンの表示項目には組織名を、値には組織IDを使用する。

#### 2.6.3.顧客検索イベント

##### (1) バリデーション処理

なし。

##### (2)　表示処理

顧客検索画面をポップアップ画面として開く。

#### 2.6.5. 確認イベント
##### (1) バリデーション処理

| No. | バリデーション名 | バリデーション内容 | メッセージID | 埋め込み文字列 | エラー発生時の |
|-----|------------------|-------------------|--------------|----------------|----------------|
| 1 | 単項目バリデーション | 全ての入力項目に対して、指定ドメインに応じたバリデーションおよび必須チェックを実施し、入力内容の妥当性を確認する。 | （ドメイン別） | （ドメイン別） | 終了する |
| 2 | 日付大小関係 | 「プロジェクト開始日付」と「プロジェクト終了日付」が両方入力されている場合、「プロジェクト開始日付」≦「プロジェクト終了日付」であること。 | validator.periodConsistencyCheck.message.ProjectUpdateForm | なし | 終了する |

上記バリデーションにおいて一箇所でもエラーが発生した場合、後続の処理は実施しない。

##### (2) DBアクセス（検索処理）
###### (a) 組織検索条件

Formの事業部、部門には更新画面で選択された組織の組織IDが設定されている。
画面には組織IDに対する組織名を表示する必要があるので、下記クエリにより組織名を取得する。

| 取得テーブル名 | 取得カラム名 |
|----------------|--------------|
| 組織 | 組織名 |

**検索条件**

組織.組織ID = 組織ID(Formから取得した組織ID)

(b)Formに設定された顧客IDをパラメータとして、顧客管理システム．顧客詳細取得APIを実行し顧客名を取得する。

##### (3) 表示処理
更新画面に入力した内容を更新確認画面に表示する。画面レイアウト、表示項目については「3. プロジェクト更新確認画面」を参照。