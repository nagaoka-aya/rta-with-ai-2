# WA10202/プロジェクト照会

## システム名
サンプルシステム

## サブシステム名
プロジェクト管理システム

## 2. WA1020201(プロジェクト検索画面)

### 2.1. 画面レイアウト

### 2.2. 一覧表示

| No. | 領域名 | ページング有無 | ソート条件 | 備考 |
|-----|--------|----------------|------------|-------|
| 1 | プロジェクト検索結果一覧 | 有 | プロジェクトID 昇順 | - |

### 2.3. 画面項目定義

| No. | 表示情報 | 画面項目種別 | 情報取得元 | 編集仕様 | 初期値 | 必須 | ドメイン名 | 【内部設計情報】 画面項目名（物理） |
|-----|----------|--------------|------------|----------|---------|------|------------|-----------------------------------|
| **領域名：プロジェクト検索条件入力** |
| 1 | 事業部 | select(pulldown) | - | - | - | - | 組織ID | divisionId |
| 2 | 部門 | select(pulldown) | - | - | - | - | 組織ID | organizationId |
| 3 | PJ種別 | checkbox | - | ＜コード値取得情報＞<br>ｺｰﾄﾞID　：C0300001<br>ｺｰﾄﾞ名称　：プロジェクト種別<br>ｺｰﾄﾞﾊﾟﾀｰﾝ：1<br>表示名称：コード値名称<br>選択なしのオプション：なし | 部門を選択 | - | プロジェクト種別 | projectType |
| 4 | PJ分類 | checkbox | - | ＜コード値取得情報＞<br>ｺｰﾄﾞID　：C0200001<br>ｺｰﾄﾞ名称　：プロジェクト分類<br>ｺｰﾄﾞﾊﾟﾀｰﾝ：1<br>表示名称：コード値名称<br>選択なしのオプション：なし | 事業部を選択 | - | プロジェクト分類 | projectClass |
| 5 | 売上高_実績_FROM(千円) | text | - | - | - | - | 金額 | salesFrom |
| 6 | 売上高_実績_TO(千円) | text | - | - | - | - | 金額 | salesTo |
| 7 | 開始日_FROM | calendar | - | ＜表示変換:日付変換＞<br>yyyy/MM/dd | - | - | 日付 | projectStartDateFrom |
| 8 | 開始日_TO | calendar | - | ＜表示変換:日付変換＞<br>yyyy/MM/dd | - | - | 日付 | projectStartDateTo |
| 9 | 終了日_FROM | calendar | - | ＜表示変換:日付変換＞<br>yyyy/MM/dd | - | - | 日付 | projectEndDateFrom |
| 10 | 終了日_TO | calendar | - | ＜表示変換:日付変換＞<br>yyyy/MM/dd | - | - | 日付 | projectEndDateTo |
| 11 | プロジェクト名で検索 | text | - | - | - | - | プロジェクト名 | projectName |
| **領域名：プロジェクト検索結果一覧** |
| 12 | PJ名 | label | プロジェクト．プロジェクト名 | プロジェクトIDをパラメータとした詳細画面の初期表示イベントへのURLをリンクで表示する。 | - | - | - | - |
| 13 | 事業部 | label | 組織．組織名 | - | - | - | - | - |
| 14 | 部門 | label | 組織．組織名 | - | - | - | - | - |
| 15 | PJ種別 | label | プロジェクト．プロジェクト種別 | ＜コード値取得情報＞<br>ｺｰﾄﾞID　：C0300001<br>ｺｰﾄﾞ名称　：プロジェクト種別<br>ｺｰﾄﾞﾊﾟﾀｰﾝ：1<br>表示名称：コード値名称<br>選択なしのオプション：なし | - | - | - | - |
| 16 | PJ分類 | label | プロジェクト．プロジェクト分類 | ＜コード値取得情報＞<br>ｺｰﾄﾞID　：C0200001<br>ｺｰﾄﾞ名称　：プロジェクト分類<br>ｺｰﾄﾞﾊﾟﾀｰﾝ：1<br>表示名称：コード値名称<br>選択なしのオプション：なし | - | - | - | - |
| 17 | PM | label | プロジェクト．プロジェクトマネージャー | - | - | - | - | - |
| 18 | 売上高_実績(千円) | label | プロジェクト．売上高 | ＜表示変換:10進数変換＞<br>3桁ごとにカンマ区切り | - | - | - | - |
| 19 | 開始日 | label | プロジェクト．プロジェクト開始日付 | ＜表示変換:日付変換＞<br>yyyy/MM/dd | - | - | - | - |
| 20 | 終了日 | label | プロジェクト．プロジェクト終了日付 | ＜表示変換:日付変換＞<br>yyyy/MM/dd | - | - | - | - |

### 2.4. 入出力一覧

| No. | 入出力名 | 種別 | I/O | DBアクセス種別 | 備考 |
|-----|----------|------|-----|---------------|------|
|     |          |      |     | C | R | U | D | ﾛｯｸ対象 |  |
| 1 | 組織 | テーブル | I | - | ○ | - | - | - | - |
| 2 | プロジェクト | テーブル | I | - | ○ | - | - | - | - |

### 2.5. 画面イベント一覧

| No. | 画面イベント名 | 発生タイミング | 画面イベント概要 | 正常時遷移先画面 | サーバ通信有無 | リクエストURL |
|-----|--------------|--------------|----------------|---------------|-------------|-------------|
| 1 | 初期表示 | - | プロジェクト検索画面を表示する。 | - | あり(同期) | /project/search |
| 2 | 部門リスト取得 | 「事業部」プルダウン選択 | 選択された事業部をもとに、配下部門リストを「部門」プルダウンに設定する。 | - | あり(非同期) | /project/departments |
| 3 | 一覧検索 | 「検索」ボタン押下 | プロジェクト結果一覧を表示する。 | プロジェクト検索画面(結果表示） | あり(同期) | /project/search/search |
| 4 | ページング | ページネーションリンク押下 | プロジェクト結果一覧を表示する。 | プロジェクト検索画面(結果表示） | あり(同期) | /project/search/search |
| 5 | プロジェクト詳細表示 | 「PJ名」リンク押下 | プロジェクトIDをキーとしてプロジェクト1件のデータを検索し、詳細画面を表示する。 | プロジェクト詳細画面 | あり(同期) | /project/detail |

### 2.6. 画面イベント詳細

#### 2.6.1. 初期表示イベント

(1) バリデーション処理

なし。

(2) DBアクセス（検索処理）
(a) 組織検索条件

| 取得テーブル名 | 取得カラム名 |
|--------------|------------|
| 組織 | 組織ID |
|     | 組織名 |
| 検索条件 |  |
| 組織.上位組織ID = NULL |  |

(3) 表示処理

(a)「事業部」プルダウンを初期化する。
- 「(2) 検索処理」の検索結果の先頭にブランクオプションを追加して、「事業部」に設定する。
- プルダウンの表示項目には組織名を、値には組織IDを使用する。

(b)領域名：プロジェクト検索結果一覧は非表示とする。

#### 2.6.2. 部門リスト取得イベント

(1) バリデーション処理

なし。

(2) DBアクセス（検索処理）
(a) 組織検索条件

| 取得テーブル名 | 取得カラム名 |
|--------------|------------|
| 組織 | 組織ID |
|     | 組織名 |
| 検索条件 |  |
| 組織.上位組織ID = 事業部（入力値） |  |

(3) 表示処理

(a)「部門」プルダウンを初期化する。
- 「(2) 検索処理」の検索結果の先頭にブランクオプションを追加して、「部門」に設定する。
- プルダウンの表示項目には組織名を、値には組織IDを使用する。

#### 2.6.3. 一覧検索イベント

(1) バリデーション処理

| No. | バリデーション名 | バリデーション内容 | メッセージID | 埋め込み文字列 | エラー発生時のバリデーション処理継続判定 |
|-----|--------------|----------------|------------|------------|-----------------------------------|
| 1 | 単項目バリデーション | 全ての入力項目に対して、指定ドメインに応じたバリデーションおよび必須チェックを実施し、入力内容の妥当性を確認する。 | （ドメイン別） | （ドメイン別） | 終了する |
| 2 | 売上高大小関係 | 「売上高_実績_FROM」と「売上高_実績_TO」が両方入力されている場合、「売上高_実績_FROM」≦「売上高_実績_TO」であること。 | validator.priceRange.message | なし | 終了する |
| 3 | 開始日大小関係 | 「開始日_FROM」と「開始日_TO」が両方入力されている場合、「開始日_FROM」≦「開始日_TO」であること。 | validator.dateRange.message | なし | 終了する |
| 4 | 終了日大小関係 | 「終了日_FROM」と「終了日_TO」が両方入力されている場合、「終了日_FROM」≦「終了日_TO」であること。 | validator.dateRange.message | なし | 終了する |

上記バリデーションにおいて一箇所でもエラーが発生した場合、後続の処理は実施しない。

(2) DBアクセス（検索処理）
(a) プロジェクト検索条件

| 取得テーブル名 | 取得カラム名 | 画面項目名 |
|--------------|------------|----------|
| プロジェクト | プロジェクトID | - |
|  | プロジェクト名 | PJ名 |
|  | プロジェクト種別 | PJ種別 |
|  | プロジェクト分類 | PJ分類 |
|  | プロジェクトマネージャー | PM |
|  | 売上高 | 売上高_実績 |
|  | プロジェクト開始日付 | 開始日 |
|  | プロジェクト終了日付 | 終了日 |
| 事業部 | 組織名 | 事業部 |
| 部門 | 組織名 | 部門 |

結合条件

プロジェクト

LEFT OUTER JOIN   組織 AS 部門
ON   プロジェクト．組織ID   =   部門．組織ID

LEFT OUTER JOIN   組織 AS 事業部
ON   部門．上位組織ID   =   事業部．組織ID

検索条件

事業部．組織ID   =   事業部（入力値）   ※　すべての条件において、
                                        　　入力がある場合のみ適用
AND   部門．組織ID   =   部門（入力値）

AND   プロジェクト．プロジェクト種別   IN   PJ種別（入力値）

AND   プロジェクト．プロジェクト分類   IN   PJ分類（入力値）

AND   プロジェクト．売上高   ≧   売上高_実績_FROM（入力値）

AND   プロジェクト．売上高   ≦   売上高_実績_TO（入力値）

AND   プロジェクト．プロジェクト開始日付   ≧   開始日_FROM（入力値）

AND   プロジェクト．プロジェクト開始日付   ≦   開始日_TO（入力値）

AND   プロジェクト．プロジェクト終了日付   ≧   終了日_FROM（入力値）

AND   プロジェクト．プロジェクト終了日付   ≦   終了日_TO（入力値）

AND   プロジェクト．プロジェクト名   like   %プロジェクト名で検索（入力値）%

ソート条件

ORDER BY   プロジェクト．プロジェクトID


(3) 表示処理

(a)「(2) 検索処理」の検索結果がない場合

検索条件および検索結果なしエラーメッセージ(errors.nothing.search.project)を
「プロジェクト検索画面(結果表示)」に表示し、領域名：プロジェクト検索結果一覧は非表示とする。

(b)「(2) 検索処理」の検索結果がある場合

検索結果を「プロジェクト検索画面(結果表示)」に表示する。
「検索」ボタン押下時は、1ページ目を表示する。

#### 2.6.4. ページングイベント

以下の条件でページ番号を指定して「2.6.3.一覧検索イベント」を行う。
- 「<<」リンク：最初のページ
- 「<」リンク：現在のページ数－1ページ
- 「ページ番号」リンク：該当ページ番号
- 「>」リンク：現在のページ数＋1ページ
- 「>>」リンク：最後のページ

#### 2.6.5. プロジェクト詳細表示イベント

「3.WA1020202(プロジェクト詳細画面)：3.6.画面イベント詳細：3.6.1.初期表示イベント」を参照。