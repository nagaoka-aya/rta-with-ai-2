<!DOCTYPE html>
<html th:replace="~{common/layout :: layout(~{:: title}, ~{:: body/content()}, true, ~{:: additionalScripts})}"
  xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../../../static/css/bootstrap.min.css" />
  <script src="../../../static/js/jquery-3.6.0.min.js"></script>
  <script src="../../../static/js/bootstrap.bundle.min.js"></script>
  <script src="../../../static/js/common.js"></script>
  <title>プロジェクト検索</title>

  <!--/* 画面固有のJavaScriptファイル */-->
  <th:block th:fragment="additionalScripts">
    <!-- サーバーサイドデータをJavaScriptに渡す -->
    <script th:src="@{/js/project/create.js}" src="../../../static/js/project/create.js" defer></script>
  </th:block>
</head>

<body class="container">
  <span></span>
  <div class="row mb-4">
    <div class="col">
      <div class="fs-2 fw-bold">プロジェクト検索</div>
    </div>
  </div>
  <form method="GET" th:action="@{/project/search/search}" action="./index.html" th:object="${projectSearchForm}">
    <span th:if="${#fields.hasGlobalErrors()}" th:errors="*{global}" class="text-danger fw-bold"></span>

    <!-- 検索条件を隠しフィールドで保持 -->
    <input type="hidden" th:field="*{pageNumber}" />

    <div class="row mb-3">
      <div class="col-6">
        <label for="divisionId" class="form-label fw-bold">事業部</label>
        <select id="divisionId" th:field="*{divisionId}" class="form-select" th:errorclass="is-invalid">
          <option value="">選択してください</option>
          <option th:each="division : ${divisions}" th:value="${division.organizationId}"
            th:text="${division.organizationName}"></option>
        </select>
        <span th:if="${#fields.hasErrors('divisionId')}" th:errors="*{divisionId}" class="invalid-feedback"></span>
      </div>
      <div class="col-6">
        <label for="organizationId" class="form-label fw-bold">部門</label>
        <select id="organizationId" th:field="*{organizationId}" class="form-select" th:errorclass="is-invalid"
          disabled>
          <option value="">選択してください</option>
        </select>
        <span th:if="${#fields.hasErrors('organizationId')}" th:errors="*{organizationId}"
          class="invalid-feedback"></span>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col">
        <div class="form-label fw-bold">PJ種別</div>
        <div class="form-check form-check-inline" th:each="codeValue : ${@codeViewHelper.getValues('C0300001','pattern01')}
          " th:classappend="${#fields.hasErrors('projectType')} ? 'is-invalid' : ''">
          <input type="checkbox" class="form-check-input" th:field="*{projectType}" th:value="${codeValue}"
            th:errorclass="is-invalid" />
          <label th:for="${#ids.prev('projectType')}" class="form-check-label"
            th:text="${@codeViewHelper.getName('C0300001',codeValue)}">SS</label>
        </div>
        <span th:if="${#fields.hasErrors('projectType')}" th:errors="*{projectType}" class="invalid-feedback"></span>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-6">
        <div class="form-label fw-bold">PJ分類</div>
        <div class="form-check form-check-inline" th:each="codeValue : ${@codeViewHelper.getValues('C0200001','pattern01')}
          " th:classappend="${#fields.hasErrors('projectClass')} ? 'is-invalid' : ''">
          <input type="checkbox" class="form-check-input" th:field="*{projectClass}" th:value="${codeValue}"
            th:errorclass="is-invalid" />
          <label th:for="${#ids.prev('projectClass')}" class="form-check-label"
            th:text="${@codeViewHelper.getName('C0200001',codeValue)}">SS</label>
        </div>
        <span th:if="${#fields.hasErrors('projectClass')}" th:errors="*{projectClass}" class="invalid-feedback"></span>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-6">
        <label for="salesFrom" class="form-label fw-bold">売上高_実績_FROM(千円)</label>
        <input type="text" th:field="*{salesFrom}" placeholder="売上高_実績_FROM" class="form-control"
          th:errorclass="is-invalid" maxlength="9" />
        <span th:if="${#fields.hasErrors('salesFrom')}" th:errors="*{salesFrom}" class="invalid-feedback"></span>
      </div>
      <div class="col-6">
        <label for="salesTo" class="form-label fw-bold">売上高_実績_TO(千円)</label>
        <input type="text" th:field="*{salesTo}" placeholder="売上高_実績_TO" class="form-control" th:errorclass="is-invalid"
          maxlength="9" />
        <span th:if="${#fields.hasErrors('salesTo')}" th:errors="*{salesTo}" class="invalid-feedback"></span>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-12">
        <span th:if="${#fields.hasErrors('validSalesRange')}" th:errors="*{validSalesRange}"
          class="invalid-feedback d-block"></span>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-6">
        <label for="projectStartDateFrom" class="form-label fw-bold">開始日_FROM</label>
        <input type="date" th:field="*{projectStartDateFrom}" placeholder="開始日_FROM" class="form-control"
          th:errorclass="is-invalid" />
        <span th:if="${#fields.hasErrors('projectStartDateFrom')}" th:errors="*{projectStartDateFrom}"
          class="invalid-feedback"></span>
      </div>
      <div class="col-6">
        <label for="projectStartDateTo" class="form-label fw-bold">開始日_TO</label>
        <input type="date" th:field="*{projectStartDateTo}" placeholder="開始日_TO" class="form-control"
          th:errorclass="is-invalid" />
        <span th:if="${#fields.hasErrors('projectStartDateTo')}" th:errors="*{projectStartDateTo}"
          class="invalid-feedback"></span>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-12">
        <span th:if="${#fields.hasErrors('validProjectStartDateRange')}" th:errors="*{validProjectStartDateRange}"
          class="invalid-feedback d-block"></span>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-6">
        <label for="projectEndDateFrom" class="form-label fw-bold">終了日_FROM</label>
        <input type="date" th:field="*{projectEndDateFrom}" placeholder="終了日_FROM" class="form-control"
          th:errorclass="is-invalid" />
        <span th:if="${#fields.hasErrors('projectEndDateFrom')}" th:errors="*{projectEndDateFrom}"
          class="invalid-feedback"></span>
      </div>
      <div class="col-6">
        <label for="projectEndDateTo" class="form-label fw-bold">終了日_TO</label>
        <input type="date" th:field="*{projectEndDateTo}" placeholder="終了日_TO" class="form-control"
          th:errorclass="is-invalid" />
        <span th:if="${#fields.hasErrors('projectEndDateTo')}" th:errors="*{projectEndDateTo}"
          class="invalid-feedback"></span>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-12">
        <span th:if="${#fields.hasErrors('validProjectEndDateRange')}" th:errors="*{validProjectEndDateRange}"
          class="invalid-feedback d-block"></span>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col">
        <label for="projectName" class="form-label fw-bold">プロジェクト名で検索</label>
        <input type="text" th:field="*{projectName}" placeholder="プロジェクト名で検索" class="form-control"
          th:errorclass="is-invalid" maxlength="128" />
        <span th:if="${#fields.hasErrors('projectName')}" th:errors="*{projectName}" class="invalid-feedback"></span>
      </div>
    </div>
    <div class="row justify-content-center pt-4">
      <div class="col-2">
        <input class="btn btn-primary w-100" type="submit" value="検索" />
      </div>
    </div>
  </form>
  <!--/* 以下検索結果時に表示する領域 */-->
  <th:block th:if="${searchExecuted}">
    <div th:if="${hasResults}">
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">PJ名</th>
            <th scope="col">事業部</th>
            <th scope="col">部門</th>
            <th scope="col">PJ種別</th>
            <th scope="col">PJ分類</th>
            <th scope="col">PM</th>
            <th scope="col">売上高_実績(千円)</th>
            <th scope="col">開始日</th>
            <th scope="col">終了日</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="project : ${projects}">
            <td>
              <a href="#" th:text="${project.projectName}">プロジェクト名1</a>
            </td>
            <td th:text="${project.divisionName}">A事業部</td>
            <td th:text="${project.organizationName}">C部門</td>
            <td th:text="${@codeViewHelper.getName('C0300001', project.projectType)}">新規開発ＰＪ</td>
            <td th:text="${@codeViewHelper.getName('C0200001', project.projectClass)}">ＳＳ</td>
            <td th:text="${project.projectManager}">マネージャー１</td>
            <td th:text="${@projectViewHelper.formatSales(project.sales)}">10,000</td>
            <td th:text="${@projectViewHelper.formatDate(project.projectStartDate)}">2019/06/01</td>
            <td th:text="${@projectViewHelper.formatDate(project.projectEndDate)}">2019/12/31</td>
          </tr>
        </tbody>
      </table>

      <!-- ページング部品 -->
      <div th:if="${page.totalPages > 1}" th:replace="common/paging :: navigation('/project/search/search', ${page})">
      </div>
    </div>
    <div th:if="${!hasResults}">
      <p th:text="#{errors.nothing.search.project}" class="text-muted"></p>
    </div>
  </th:block>
</body>

</html>